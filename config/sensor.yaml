- platform: systemmonitor
  resources:
    - type: disk_use_percent
      arg: /
    - type: memory_use_percent
    - type: processor_use
    - type: load_1m
    - type: load_5m
    - type: load_15m
- platform: template
  sensors:
    wan_router_ping_round_time:
      value_template: "{{ state_attr('binary_sensor.ping_wan_router', 'round_trip_time_avg') | float }}"
      unit_of_measurement: "ms"
    google_ping_round_time:
      value_template: "{{ state_attr('binary_sensor.ping_google', 'round_trip_time_avg') | float }}"
      unit_of_measurement: "ms"
    pressure_hourly_trend:
      value_template: "{{ ((state_attr('binary_sensor.pressure_trend_storm', 'gradient') | float) * 3600) | round(2) }}"
      friendly_name: "Ilmanpaineen trendi (hPa/h)"
      unit_of_measurement: "hPa"
    living_room_brightness_difference:
      value_template: >
        {% set current = states('sensor.olohuoneen_valoisuus') | float %}
        {% set target = states('input_number.living_room_brightness_target') | float %}
        {{ (target - current) | float | round(2) }}
      friendly_name: "OH valoisuuden erotus"
      unit_of_measurement: "%"
    living_room_brightness_needed_change:
      value_template: >
        {% set current = states('sensor.olohuoneen_valoisuus') | float %}
        {% set target = states('input_number.living_room_brightness_target') | float %}
        {% set damping = states('input_number.living_room_brightness_damping') | float %}
        {% set new_val = ((target - current) * damping) | int %}
        {{ new_val }}
      friendly_name: "OH valaistuksen asetuksen muutospyynti"
      unit_of_measurement: "#"
    lr_brightness_target:
      value_template: "{{ states('input_number.living_room_brightness_target') | int }}"
      friendly_name: "OH valoisuuden pyynti"
      unit_of_measurement: "%"
    lr_brightness_setting:
      value_template: "{{ states('input_number.living_room_light_auto_brightness') | int }}"
      friendly_name: "OH valaistuksen esiasetus"
      unit_of_measurement: "#"
    sun_elevation:
      value_template: "{{ state_attr('sun.sun', 'elevation') }}"
      friendly_name: "Auringon korkeus"
      unit_of_measurement: "°"
    sun_azimuth:
      value_template: "{{ state_attr('sun.sun', 'azimuth') }}"
      friendly_name: "Auringon sijainti"
      unit_of_measurement: "°"
    bedroom_humidifier_status:
      friendly_name: "MH ilmankostuttimen tila"
      value_template: >-
        {% if is_state('input_boolean.bedroom_humidifier_empty', 'on') %}
          empty
        {% elif is_state('switch.tp_link_smart_plug_5f83', 'off') %}
          off
        {% elif (states('sensor.tp_link_smart_plug_5f83_current_consumption') | float) > 50 %}
          humidifying
        {% elif is_state('switch.tp_link_smart_plug_5f83', 'on') %}
          standby
        {% else %}
          failed
        {% endif %}
- platform: rest
  resource: !secret hue_sensor_2
  value_template: "{{ value_json.config.battery }}"
  unit_of_measurement: "%"
  scan_interval: 1800
  name: "Eteisen liiketunnistimen paristo"
- platform: rest
  resource: !secret hue_sensor_20
  value_template: "{{ value_json.config.battery }}"
  unit_of_measurement: "%"
  scan_interval: 1800
  name: "Keittiön liiketunnistimen paristo"
- platform: rest
  resource: !secret hue_sensor_24
  value_template: "{{ value_json.config.battery }}"
  unit_of_measurement: "%"
  scan_interval: 1800
  name: "Pesuhuoneen liiketunnistimen paristo"
- platform: time_date
  display_options:
    - "time"
    - "date"
    - "beat"
- platform: waqi
  token: !secret aqicn_api_token
  locations:
    - "ihala, raisio"
