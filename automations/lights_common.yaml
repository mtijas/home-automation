# Common light automations

- id: circadian_rhythm_setting_changes
  alias: "Valaistuksen asetusten muutokset kellonajan mukaan"
  trigger:
    - platform: time_pattern
      minutes: "/5"
  action:
    - service: python_script.circadian_rhythm

- id: light_auto_home_mode_selector_follow_home_mode
  alias: "Light auto-home-mode-selectors to follow Home Mode"
  mode: restart
  trigger:
    - platform: state
      entity_id: input_select.home_mode
  action:
    - service: input_select.select_option
      target:
        entity_id:
          - input_select.light_auto_home_mode_living_room
      data:
        option: "{{ trigger.to_state.state }}"

- id: light_store_state_results
  alias: "Valoautomatiikan tilojen p√§ivitys"
  mode: queued
  trigger:
    - platform: state
      entity_id: input_boolean.light_auto_awake_state_living_room
      variables:
        room: living_room
        home_mode: Awake
    - platform: state
      entity_id: input_boolean.light_auto_asleep_state_living_room
      variables:
        room: living_room
        home_mode: Asleep
    - platform: state
      entity_id: input_boolean.light_auto_away_state_living_room
      variables:
        room: living_room
        home_mode: Away
    - platform: state
      entity_id: input_boolean.light_auto_party_state_living_room
      variables:
        room: living_room
        home_mode: Party
    - platform: state
      entity_id: input_boolean.light_auto_emergency_state_living_room
      variables:
        room: living_room
        home_mode: Emergency
  condition:
    - condition: template
      value_template: "{{ is_state('input_select.light_auto_home_mode_'+room, home_mode) }}"
    - condition: state
      entity_id: "input_select.light_base_mode_{{ room }}"
      state: Automatic
  action:
    - service_template: "input_boolean.turn_{{ states(trigger.entity_id) }}"
      entity_id: "input_boolean.light_result_state_{{ room }}"

- id: light_store_results_automation_on_mode_change
  alias: "Valaistuksen moodien muutokset"
  mode: queued
  trigger:
    - platform: state
      entity_id: input_select.light_base_mode_living_room
      variables:
        room: living_room
    - platform: state
      entity_id: input_select.light_auto_home_mode_living_room
      variables:
        room: living_room
  action:
    sequence:
    - choose:
        - conditions:
            - condition: state
              entity_id: "input_select.light_base_mode_{{ room }}"
              state: "Off"
          sequence:
            - service: input_boolean.turn_off
              entity_id: "input_boolean.light_result_state_{{ room }}"
        - conditions:
            - condition: state
              entity_id: "input_select.light_base_mode_{{ room }}"
              state: "Automatic"
            - condition: state
              entity_id: "input_select.light_auto_home_mode_{{ room }}"
              state: "Awake"
          sequence:
            - service_template: "input_boolean.turn_{{ states('input_boolean.light_auto_awake_state_'+room) }}"
              entity_id: "input_boolean.light_result_state_{{ room }}"
        - conditions:
            - condition: state
              entity_id: "input_select.light_base_mode_{{ room }}"
              state: "Automatic"
            - condition: state
              entity_id: "input_select.light_auto_home_mode_{{ room }}"
              state: "Asleep"
          sequence:
            - service_template: "input_boolean.turn_{{ states('input_boolean.light_auto_asleep_state_'+room) }}"
              entity_id: "input_boolean.light_result_state_{{ room }}"
        - conditions:
            - condition: state
              entity_id: "input_select.light_base_mode_{{ room }}"
              state: "Automatic"
            - condition: state
              entity_id: "input_select.light_auto_home_mode_{{ room }}"
              state: "Away"
          sequence:
            - service_template: "input_boolean.turn_{{ states('input_boolean.light_auto_away_state_'+room) }}"
              entity_id: "input_boolean.light_result_state_{{ room }}"
        - conditions:
            - condition: state
              entity_id: "input_select.light_base_mode_{{ room }}"
              state: "Automatic"
            - condition: state
              entity_id: "input_select.light_auto_home_mode_{{ room }}"
              state: "Party"
          sequence:
            - service_template: "input_boolean.turn_{{ states('input_boolean.light_auto_party_state_'+room) }}"
              entity_id: "input_boolean.light_result_state_{{ room }}"
        - conditions:
            - condition: state
              entity_id: "input_select.light_base_mode_{{ room }}"
              state: "Automatic"
            - condition: state
              entity_id: "input_select.light_auto_home_mode_{{ room }}"
              state: "Emergency"
          sequence:
            - service_template: "input_boolean.turn_{{ states('input_boolean.light_auto_emergency_state_'+room) }}"
              entity_id: "input_boolean.light_result_state_{{ room }}"


