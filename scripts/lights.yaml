light_brightness_calculation:
  sequence:
    - service: input_number.set_value
      target:
        entity_id: "{{ target_entity }}"
      data:
        value: >
          {% set needed_change = ((lightness_target - current_lightness) * speed_multiplier) | int %}
          {% set new_val = ( previous_value + needed_change ) | round(0, 'ceil') %}
          {% if new_val > 255 %}
            255
          {% elif new_val < 5 %}
            5
          {% else %}
            {{ new_val }}
          {% endif %}

turn_cloakroom_light_on_with_settings:
  sequence:
    - service: light.turn_on
      target:
        entity_id: light.vaatehuone
      data:
        brightness: "{{ light_brightness }}"
    - delay: "00:00:03"
    - service: light.turn_on
      target:
        entity_id: light.vaatehuone
      data:
        kelvin: "{{ light_kelvin }}"
