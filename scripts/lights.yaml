light_brightness_calculation:
  sequence:
    - service: input_number.set_value
      data_template:
        entity_id: "input_number.light_auto_awake_brightness_{{ target_name }}"
        value_template: >
          {% set current_setting = states('input_number.light_auto_awake_brightness_'+target_name) | float %}
          {% set current_lightness = states('sensor.current_lightness_'+target_name) | float %}
          {% set target = states('input_number.light_auto_lightness_target_'+target_name) | float %}
          {% set damping = states('input_number.light_auto_brightness_damping_'+target_name) | float %}
          {% set needed_change = ((target - current_lightness) * damping) | int %}
          {% set new_val = ( current_setting + needed_change ) | round(0, 'ceil') %}
          {% if new_val > 255 %}
            255
          {% elif new_val < 5 %}
            5
          {% else %}
            {{ new_val }}
          {% endif %}

turn_cloakroom_light_on_with_settings:
  sequence:
    - service: light.turn_on
      data_template:
        entity_id: light.vaatehuone
        brightness: "{{ light_brightness }}"
    - delay: "00:00:03"
    - service: light.turn_on
      data_template:
        entity_id: light.vaatehuone
        kelvin: "{{ light_kelvin }}"

turn_on_decorative_lights_to_default:
  sequence:
    - service: light.turn_on
      data_template:
        entity_id: light.koristevalot
        brightness: "{{ states('input_number.decorative_lights_default_brightness')|float }}"
        transition: 10
    - service: light.turn_on
      data_template:
        entity_id: light.oh_valonauhat
        brightness: "{{ states('input_number.living_room_lightstrips_default_brightness')|float }}"
        kelvin: "{{ states('input_number.light_result_kelvin_living_room')|float }}"
        transition: 10
