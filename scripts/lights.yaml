light_brightness_calculation:
  sequence:
    - service: input_number.set_value
      target:
        entity_id: "{{ target_entity }}"
      data:
        value: >
          {% set needed_change = ((lightness_target - current_lightness) * damping) | int %}
          {% set new_val = ( previous_value + needed_change ) | round(0, 'ceil') %}
          {% if new_val > 255 %}
            255
          {% elif new_val < 5 %}
            5
          {% else %}
            {{ new_val }}
          {% endif %}

turn_cloakroom_light_on_with_settings:
  sequence:
    - service: light.turn_on
      target:
        entity_id: light.vaatehuone
      data:
        brightness: "{{ light_brightness }}"
    - delay: "00:00:03"
    - service: light.turn_on
      target:
        entity_id: light.vaatehuone
      data:
        kelvin: "{{ light_kelvin }}"

turn_on_decorative_lights_to_default:
  sequence:
    - service: light.turn_on
      target:
        entity_id: light.koristevalot
      data:
        brightness: "{{ states('input_number.decorative_lights_default_brightness')|float }}"
        transition: 10
    - service: light.turn_on
      target:
        entity_id: light.oh_valonauhat
      data:
        brightness: "{{ states('input_number.living_room_lightstrips_default_brightness')|float }}"
        kelvin: "{{ states('input_number.light_result_kelvin_living_room')|float }}"
        transition: 10
