light_brightness_calculation:
  sequence:
    - variables:
        current_setting: "{{ states('input_number.light_auto_awake_brightness_'+target_name) | float }}"
        current_lightness: "{{ states('sensor.current_lightness_'+target_name) | float }}"
        lightness_target: "{{ states('input_number.light_auto_lightness_target_'+target_name) | float }}"
        damping: "{{ states('input_number.light_auto_brightness_damping_'+target_name) | float }}"
    - service: input_number.set_value
      entity_id: "{{ 'input_number.light_auto_awake_brightness_'+target_name }}"
      data:
        value: >
          {% set needed_change = ((lightness_target - current_lightness) * damping) | int %}
          {% set new_val = ( current_setting + needed_change ) | round(0, 'ceil') %}
          {% if new_val > 255 %}
            255
          {% elif new_val < 5 %}
            5
          {% else %}
            {{ new_val }}
          {% endif %}

turn_cloakroom_light_on_with_settings:
  sequence:
    - service: light.turn_on
      entity_id: light.vaatehuone
      data:
        brightness: "{{ light_brightness }}"
    - delay: "00:00:03"
    - service: light.turn_on
      entity_id: light.vaatehuone
      data:
        kelvin: "{{ light_kelvin }}"

turn_on_decorative_lights_to_default:
  sequence:
    - service: light.turn_on
      entity_id: light.koristevalot
      data:
        brightness: "{{ states('input_number.decorative_lights_default_brightness')|float }}"
        transition: 10
    - service: light.turn_on
      entity_id: light.oh_valonauhat
      data:
        brightness: "{{ states('input_number.living_room_lightstrips_default_brightness')|float }}"
        kelvin: "{{ states('input_number.light_result_kelvin_living_room')|float }}"
        transition: 10
